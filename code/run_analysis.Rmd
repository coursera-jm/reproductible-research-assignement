<style>
body, th, td, p {
    font-size: 1.0em;
    font-family: "Arial, Helvetica, sans-serif"";
}
table {
   max-width: 95%;
   border: 1px solid #ccc;
   padding: 4px 4px 4px 4px; 
}
th {
  background-color: #000000;
  color: #ffffff;
  padding: 4px 4px 4px 4px; 
}
td {
  background-color: #dcdcdc;
  padding: 4px 4px 4px 4px; 
}
</style>

##  Severe Weather Events related to Public Health and Economic Problems

### Synopsis

Storms and other severe weather events can cause both public health and economic problems for communities and municipalities. Many severe events can result in fatalities, injuries, and property damage, and preventing such outcomes to the extent possible is a key concern.

The Objective of this assignment is to explore theU.S. National Oceanic and Atmospheric Administration's (NOAA) Storm Database and determine, across the United States, which types of events are most harmful with respect to population health, and which types of events have the greatest economic consequences.

The NOAA database tracks characteristics of major storms and weather events in the United States, including when and where they occur, as well as estimates of any fatalities, injuries, and property damage.

The events in the database start in the year 1950 and end in November 2011. In the earlier years of the database there are generally fewer events recorded, most likely due to a lack of good records. More recent years should be considered more complete.

### Data Processing

```{r setup, echo=FALSE}
# set global options
opts_chunk$set(echo=TRUE)
```

We then clean-up our workspace, set the seed for reproductibility, remember processing date and time and R version for reference, and show the parameters of the session. 
```{r init, echo=FALSE}
# cleanup
rm(list=ls())

#libraries
library(lattice)
library (xtable)

# for reproductibility
set.seed(590607)

# some usefule variables
dt = Sys.time()
date <- format(dt,"%d-%b-%Y")
time <- format(dt,"%H:%M:%S")
Rversion <- version$version.string
```
```{r showSession}
# show environment
sessionInfo()
```

The data for this assignment comes in the form of a comma-separated-value compressed file downloaded from https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2. The following code download this file if necessary and keep the date and time of when the download occured for future reference.

```{r downloadData}
# baseDir will be prefixing all data accesses
baseDir <- ".."

# create data sub-directory if necessary
dataDir <- file.path(baseDir, "data")
if(!file.exists(dataDir)) { dir.create(dataDir) }

zipFilePath <- file.path(dataDir, "StormData.csv.bz2")
dateFilePath <- file.path(dataDir, "date_time_downloaded.txt")
# download original data if necessary (skip if exists already as it takes time and bandwith)
# just delete the bz2 file in data subdir to trigger a fresh download
if (!file.exists(zipFilePath)) { 
  zipFileUrl <- "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2"
  download.file (zipFileUrl, zipFilePath, method="curl")
  DTDownloaded <- format(Sys.time(), "%Y-%b-%d %H:%M:%S")
  cat (DTDownloaded, file=dateFilePath)
} else {
  DTDownloaded <- scan(file=dateFilePath, what="character", sep="\n")
}
```

We load data in R using read.csv and bzfile.
```{r loadData, cache=TRUE}
# read dataset and load data in R
dataset.raw <- read.csv(bzfile(zipFilePath), header = TRUE) 
```

The NOAA downloaded dataset is located at ```r zipFilePath``` and was downloaded on ```r DTDownloaded```. This raw dataset contains ```r nrow(dataset.raw)``` observations and ```r ncol(dataset.raw)``` variables.

The documentation was downloaded from the National Weather Service Storm Data Documentation [1] and from the National Climatic Data Center Storm Events FAQ [2].

This analysis has been performed using R software package for statistical analysis [3]. The version of R used was `r Rversion`.


### Description and justification for data transformations.

The type of event is determined by the EVTYPE variable. By looking at the raw dataset, we can see that EVTYPE is a composite, with several way of calling the same event (e.g "THUNDERTORM WINDS", "THUNDERSTORMWINDS", "THUNDERSTROM WIND"), events groups on the same records (e.g. "GUSTY WIND/HVY RAIN"), and summary records instead of individual events (e.g. "Summary of June 3").
We can see here the unique event listed:
```{r dataPreProcessing1}
unique(dataset.raw$EVTYPE)
```

In order to normalize EVTYPE, we perform the following transformations:
  - everything to lowercase
  - suppress plural marks
  - correct spelling issues
```{r dataPreProcessing2, results="asis"}
```

We then delete the daily summaries which don't correct to an event:
```{r dataPreProcessing3, results="asis"}
t3 <- xtable(summary(fit))
print (t3, type="html")
```


### Results

```{r results.fit}
```

The table of regression coefficients shows as follow:
```{r results.coef, results="asis"}
```
 
which types of events are most harmful to population health?
 
which types of events have the greatest economic consequences?

### Discussion

The test dataset provided was very limited in size (`r #nrow(testSet)` rows).


### Conclusion

This brief analysis prepared for the second assignement of Coursera "Reproductible Research" tried to determine which events are harmful to the population health and economics parameters.
 
This document was generated on `r date` at `r time`.

### References

1. National Weather Service Storm Data Documentation retrieved from https://d396qusza40orc.cloudfront.net/repdata%2Fpeer2_doc%2Fpd01016005curr.pdf on 17-Jun-2014.

2. National Climatic Data Center Storm Events FAQ retrived from https://d396qusza40orc.cloudfront.net/repdata%2Fpeer2_doc%2FNCDC%20Storm%20Events-FAQ%20Page.pdf on 17-Jun-2014.

3. R Core Team. R: A language and environment for statistical computing. URL: http://www.R-project.org. R Foundation for Statistical Computing, 2013.

2. Seber, George AF, and Alan J. Lee. Linear regression analysis. Vol. 936. Wiley, 2012.

3. R Markdown Page. URL: http://www.rstudio.com/ide/docs/authoring/using_markdown. 

4. Roger D. Peng, PhD, Jeff Leek, PhD, and Brian Caffo, PhD. Reproductible Research. Coursera June 2014 session. 

